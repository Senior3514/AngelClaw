# ANGELGRID â€“ Development docker-compose (legacy location)
#
# Prefer using ops/docker-compose.yml instead:
#   cd ops && docker compose up --build
#
# This file is kept for backwards compatibility.

services:
  angelnode:
    build:
      context: ../..
      dockerfile: ops/docker/Dockerfile.angelnode
    ports:
      - "127.0.0.1:8400:8400"
    volumes:
      - angelnode-logs:/var/log/angelgrid
    environment:
      - ANGELNODE_POLICY_FILE=/app/angelnode/config/default_policy.json
      - ANGELNODE_CATEGORY_DEFAULTS_FILE=/app/angelnode/config/category_defaults.json
      - ANGELNODE_LOG_FILE=/var/log/angelgrid/decisions.jsonl
      - ANGELGRID_CLOUD_URL=http://cloud:8500
      - ANGELGRID_TENANT_ID=dev-tenant
      - ANGELGRID_SYNC_INTERVAL=60
    depends_on:
      - cloud

  cloud:
    build:
      context: ../..
      dockerfile: ops/docker/Dockerfile.cloud
    expose:
      - "8500"
    volumes:
      - cloud-data:/data
    environment:
      - ANGELGRID_DATABASE_URL=sqlite:////data/angelgrid.db

volumes:
  angelnode-logs:
  cloud-data:
